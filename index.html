<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f62fe" />
  <title>和英正順PWA v3.4.1 – データセット対応</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="topbar">
    <h1>和英正順アプリ（PWA）v3.4.1</h1>
    <div class="dataset-ctl">
      <label>データセット</label>
      <select id="datasetSelect"></select>
      <button id="addDatasetBtn">＋新規</button>
      <button id="renameDatasetBtn">名称変更</button>
      <button id="deleteDatasetBtn" class="danger">削除</button>
    </div>
  </div>
  <nav>
    <button data-tab="practice" class="active">練習</button>
    <button data-tab="problems">問題</button>
    <button data-tab="history">履歴</button>
    <button data-tab="settings">設定</button>
  </nav>
</header>

<main>
  <section id="practice" class="tab active">
    <div class="card">
      <div class="label">日本文</div>
      <div id="jpText" class="jp"></div>
      <hr/>
      <div class="label">並べ替え</div>
      <div id="answerArea" class="answer"></div>
      <div id="tokenPool" class="pool"></div>
      <div class="row">
        <button id="undoBtn">UNDO</button>
        <button id="resetBtn">RESET</button>
        <button id="shuffleBtn" class="warn">SHUFFLE</button>
        <span class="flex"></span>
        <button id="checkBtn" class="primary">CHECK</button>
        <button id="nextBtn">次へ</button>
      </div>
      <div class="row tts-row">
        <button id="speakJPBtn">JP▶︎</button>
        <button id="speakENBtn">EN▶︎</button>
        <button id="speakSeqBtn" class="primary">JP→EN▶︎</button>
        <label class="switch"><input type="checkbox" id="autoplayChk"/><span>自動で次へ</span></label>
        <button id="stopSpeakBtn" class="danger">停止</button>
      </div>
      <div id="result" class="result"></div>
      <div id="explanationWrap" class="explain hidden">
        <div class="label">解説</div>
        <div id="explanation" class="explanation"></div>
      </div>
    </div>
  </section>

  <section id="problems" class="tab">
    <div class="card">
      <div class="row wrap">
        <input id="problemSearch" placeholder="日本文/英文で検索">
        <span class="flex"></span>
        <div class="row">
          <button id="problemsPlayAllBtn" class="primary">一覧JP→EN自動再生</button>
          <button id="problemsStopBtn" class="danger">停止</button>
        </div>
        <input id="csvInput" type="file" accept=".csv,text/csv" hidden>
        <button id="csvBtn">CSVインポート</button>
        <button id="exportCsvBtn">CSVエクスポート</button>
      </div>
      <div id="problemsList" class="list"></div>
    </div>
  </section>

  <section id="history" class="tab">
    <div class="card">
      <div class="row">
        <select id="histFilter">
          <option value="all">すべて</option>
          <option value="correct">正解のみ</option>
          <option value="wrong">不正解のみ</option>
        </select>
        <input id="histSearch" placeholder="日本文/英文/解答で検索">
        <span class="flex"></span>
        <div class="row">
          <button id="historyPlayAllBtn" class="primary">一覧JP→EN自動再生</button>
          <button id="historyStopBtn" class="danger">停止</button>
        </div>
      </div>
      <div id="historyList" class="list"></div>
    </div>
  </section>

  <section id="settings" class="tab">
    <div class="card">
      <h3>OpenAI API キー（解説生成用）</h3>
      <div class="row">
        <input id="apiKey" placeholder="sk-..." />
        <button id="saveKeyBtn" class="primary">保存</button>
        <button id="deleteKeyBtn" class="danger">削除</button>
      </div>
      <p class="note">解説はOpenAI APIを使用します。</p>
    </div>

    <div class="card">
      <h3>TTS設定（リピート・音量）</h3>
      <div class="row">
        <label class="slider">
          1項目のリピート回数（1〜10）
          <input type="range" min="1" max="10" step="1" id="repeatCount">
          <span id="repeatCountVal"></span>
        </label>
      </div>
      <div class="row">
        <label class="slider">
          再生音量（0〜1.0）※端末音量も影響
          <input type="range" min="0" max="1" step="0.01" id="baseVolume">
          <span id="baseVolumeVal"></span>
        </label>
      </div>
      <div class="row">
        <label class="slider">
          背景再生用ブースト（dB, 0〜+12）
          <input type="range" min="0" max="12" step="1" id="boostDb">
          <span id="boostDbVal"></span>
        </label>
      </div>
      <p class="note">※ブーストは「背景再生オーディオ」モードのときのみ有効。</p>
    </div>

    <div class="card">
      <h3>読み上げ（TTS）モード</h3>
      <div class="row">
        <label><input type="radio" name="ttsMode" value="webspeech"> Web Speech（端末内・簡易）</label>
      </div>
      <div class="row">
        <label><input type="radio" name="ttsMode" value="audio"> 背景再生オーディオ（推奨）</label>
      </div>
      <div class="row">
        <input id="ttsEndpoint" placeholder="https://your-worker.example.com/tts?lang={lang}&text={text}" />
        <button id="saveTtsEndpoint" class="primary">TTSエンドポイント保存</button>
      </div>
    </div>

    <div class="card">
      <h3>読み上げタイミング</h3>
      <div class="row">
        <label class="slider">
          JP → EN 開始まで（秒）
          <input type="range" min="0.5" max="10" step="0.1" id="delayJPEN">
          <span id="delayJPENVal"></span>
        </label>
      </div>
      <div class="row">
        <label class="slider">
          次のJP開始まで（秒）
          <input type="range" min="0.5" max="10" step="0.1" id="delayNextJP">
          <span id="delayNextJPVal"></span>
        </label>
      </div>
    </div>
  </section>
</main>

<audio id="ttsAudio" preload="auto" crossorigin="anonymous"></audio>

<footer>
  <span>和英正順PWA v3.4.1</span>
  <span class="flex"></span>
  <a id="installHint" href="#" class="install-hint hidden">ホーム画面に追加</a>
</footer>

<script src="app.js"></script>
</body>
</html>
